# NPC Personality System - NPC個性システム

NPCの個性と行動パターンを定義し、より多様で予測不可能な戦術的判断を実現します。

## 🎭 基本個性タイプ

### 攻撃的 (Aggressive)
```
攻撃性: 8-10
知能: 4-7
忠誠度: 6-8

行動特性:
- 近接戦闘を好む
- HP50%以下でも積極的に攻撃
- 味方への支援より敵への攻撃優先
- 地形無視で直線的移動

戦術パターン:
- "charge_closest": 最も近い敵に突撃
- "berserker_rush": HP低下時の無謀攻撃
- "intimidate_advance": 威嚇しながら前進
```

### 慎重 (Cautious)
```
攻撃性: 2-5
知能: 7-9
忠誠度: 7-10

行動特性:
- 防御的位置取りを重視
- HP75%以下で後退検討
- 味方との連携を優先
- 地形を戦術的に活用

戦術パターン:
- "defensive_formation": 味方と防御陣形
- "tactical_retreat": 計画的後退
- "cover_seeking": 遮蔽物利用
```

### 狡猾 (Cunning)
```
攻撃性: 5-8
知能: 8-10
忠誠度: 3-6

行動特性:
- 不意打ち・奇襲を狙う
- 弱った敵を優先攻撃
- 味方を盾として利用
- 予測困難な移動パターン

戦術パターン:
- "flank_attack": 側面攻撃
- "opportunist_strike": 機会攻撃
- "feint_maneuver": フェイント移動
```

### 英雄的 (Heroic)
```
攻撃性: 6-8
知能: 6-8
忠誠度: 9-10

行動特性:
- 味方保護を最優先
- 劣勢でも逃げない
- 戦術的に最適な判断
- 予測可能だが効果的

戦術パターン:
- "protect_allies": 味方援護優先
- "last_stand": 最後の抵抗
- "coordinated_attack": 連携攻撃
```

### 混沌 (Chaotic)
```
攻撃性: 1-10 (ランダム)
知能: 3-7
忠誠度: 1-8

行動特性:
- 予測不可能な行動
- 感情に左右される判断
- 極端な選択を取りがち
- ターンごとに性格変化

戦術パターン:
- "random_chaos": 完全ランダム行動
- "mood_swing": 気分による戦術変更
- "wild_card": 想定外の行動
```

## 🧮 個性別判断アルゴリズム

### 攻撃的タイプの評価式
```
選択肢スコア = 基本スコア + 個性修正

個性修正:
- 攻撃行動: +3.0
- 前進行動: +2.0
- 防御行動: -2.0
- 後退行動: -3.0
- 敵との距離が近い: +1.5
- HP減少による攻撃性ボーナス: (100 - HP%) * 0.02
```

### 慎重タイプの評価式
```
個性修正:
- 防御行動: +3.0
- 味方との連携: +2.5
- 地形利用: +2.0
- 無謀な攻撃: -3.0
- HP安全マージン: (現HP / 最大HP) * 2.0
- 味方との距離維持: 距離2以内 +1.5
```

### 狡猾タイプの評価式
```
個性修正:
- 側面・背面攻撃: +3.5
- 弱った敵への攻撃: +(100 - 敵HP%) * 0.03
- 数的優位での攻撃: +2.0
- 正面からの攻撃: -1.5
- 不利な状況での逃走: +2.5
```

### 英雄的タイプの評価式
```
個性修正:
- 味方保護行動: +4.0
- 連携攻撃: +2.5
- 戦術的最適解: +2.0
- 味方見捨て行動: -5.0
- 危険な味方への接近: +1.5
```

### 混沌タイプの評価式
```
個性修正:
- ランダム係数: (-2.0 to +2.0)
- 気分値による修正: 現在気分 * 0.5
- 前ターンと同じ行動: -1.0
- 予想外度ボーナス: +0.5 to +2.0

気分値変化:
- 攻撃成功: +2
- 攻撃失敗: -1
- ダメージ受ける: -1
- 味方がやられる: -2
```

## 🎲 個性適用の実装ガイド

### GM_CORE_MIND.mdでの個性参照
```
ステップ2.5: NPC個性適用

1. NPCの個性タイプを確認
2. 該当する行動特性を参照
3. 戦術パターンから選択肢を生成
4. 個性別評価式で修正値を計算
5. 最終スコアで行動決定
```

### 個性の動的変化
```
経験による変化:
- 連続成功 → 攻撃性+1, 知能+1
- 連続失敗 → 攻撃性-1, 慎重さ+1
- 味方の死 → 忠誠度変化, 攻撃性変化
- 劣勢継続 → 知能+1, 攻撃性調整

変化限界: ±3ポイント (極端すぎる変化を防ぐ)
```

### 複数NPC間の相互作用
```
相性システム:
- 攻撃的 + 慎重 = バランス型連携
- 狡猾 + 攻撃的 = 高リスク高リターン
- 英雄的 + 任意 = 他NPCの忠誠度+1
- 混沌 + 任意 = 予測困難な連携

影響範囲: 隣接タイル内のNPC同士
```

## 📊 個性システムの効果測定

### 多様性指標
- 同一行動連続回数の削減 (目標: 3回未満)
- 戦術パターンの使用分散度
- プレイヤー予測的中率の低下

### 物語的効果
- NPCキャラクターの記憶に残る度
- 戦闘の緊張感レベル
- 物語展開の意外性

---

この個性システムにより、各NPCが一貫した個性を持ちながら、状況に応じて動的に変化する豊かな戦術的多様性を実現できます。